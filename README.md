# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовый код

**1. Класс Component**
Представляет View в данной архитектурной модели.
Является родителем для всех компонентов представления приложения.
Компонент принимает контейнер, который будет сохранен как защищеное свойство.
Содержит инструментарий для работы с DOM. Включает следующие методы:

* toggleClass - переключение класса;
* setText - установка текста;
* setDisabled - деактивирование кнопок;
* setHidden - скрытие дочерних элементов, которые есть в блоках;
* setVisible - показ дочерних элементов, которые есть в блоках;
* setImage - установка изображений;
* render - получает опциональные данные. При их наличии, устанавливает их в объект.

**2. Класс EventEmitter**
Позволяет подписываться на события и уведомлять подписчиков о наступлении события.
Класс имеет методы:
* on - для подписки на событие;
* off - отписки от события;
* emit - уведомления подписчиков о наступлении события;
* onAll - для подписки на все события;
* offAll - для сброса всех подписчиков.
* trigger - генерирует заданное событие с заданными аргументами. 

**3. Класс Model**
Слой данных, задача которого получить исходные данные, которые будут установлены в класс и события, чтобы уведомлять код о том, что событие произошло.
Для уведомления метод:
* emitChanges - с помощью него сообщаем, что конкретно изменилось и какие данные связаны с этим изменением.

**4. Класс API**
Содержит в себе настройки для отправки запросов на сервер.

## Компоненты модели данных (бизнес-логика)

**1. Класс AppState**
Наследует класс Model. Реализует интерфейс IAppState. Хранит все данные приложения и сообщает об изменениях.
Включает следующие поля:
basket - корзина, состоящая из массива id продуктов, которые в нее добавлены;
catalog - каталог товаров на странице, состоящий из массива ProductItem;
order - заказ, реализующий интерфейс IOrder;
preview - превью карточки товара, хранит id выбранной карточки;
formErrors - ошибки валидации реализует тип FormErrors.

Также включает следующие методы:
* toggleOrderedProduct - добавляет и удаляет продукт из корзины;
* getAddedProducts - возращает добавленные в корзину продукты;
* getBasketItemsCount - подсчитывает количество добавленных продуктов;
* getTotal - подсчитывает сумму заказа в корзине;
* clearBasket - очищает корзину;
* setCatalog - настраивает вывод каталога товаров;
* setPreview - настраивает отображение выбранной карточки;
* setOrderField - настраивает форму заказа;
* validateOrder - настраивает валидацию формы 'order';
* validateContacts - настраивает валидацию формы 'contacts'.

**2. Класс ProductItem**
Хранит данные каждого товара. Наследует класс Model, реализует интерфейс IProduct.

**3. Класс StoreAPI**
Наследует класс API. Через класс осуществляется работа с API.
Имплементирует интерфейс IStoreAPI и его методы:
* getProductItem - запрос каждого товара с сервера;
* getProductList - запрос списка товаров с сервера;
* orderProducts - отправка заказа на сервер.

## Компоненты представления

**1. Класс Page**
Наследует класс Component. Реализует интерфейс IPage.
Содержит следующие поля для отрисовки компонентов страницы:
counter - счетчик корзины;
catalog - каталог товаров;
wrapper - обертка страницы;
basket - корзина.

Counter (счетчик), catalog (каталог) и locked (блокировка прокрутки страницы) устанавливаются с помощью соответствующих сеттеров.

**2. Класс Card**
Является родительским классом для всех классов отображения карточек в приложении.
Наследует Component и через дженерик определяет данные, с которыми этот компонент будет работать.
Реализует интерфейс ICard, который описывает все данные, которые класс принимает для последующей отрисовки на странице.
Отрисовывает составляещие компонента из шаблона и выводит необходимые данные с помощью сеттеров и геттеров.

Дочерние классы:
Класс CatalogCard - отображение карточки в каталоге;
Класс PreviewCard - отображение карточки в превью;
Класс BasketCard - отображение карточки в корзине.

**3. Класс Basket**
Наследует Component, реализует интерфейс IBasketView. Отрисовывает открытую корзину с товарами.
В корзину добавляются карточки товаров с возможностью удаления. По кнопке "Оформить" открывается форма оформления заказа. 

**4. Класс Form**
Наследует Component, реализует интерфейс IFormState. Содержит настройки отображения валидации форм на странице.
Содежит поля submit для регулирования кнопки подтверждения и errors для вывода ошибок при заполнении форм.
А также метод onInputChange для отслеживания изменения полей ввода и метод render для сборки формы.

Дочерним являются классы:
Order - реализует интерфейс IOrderForm. Выводит на страницу отображение первого окна оформления заказа с выбором метода оплаты и вводом адреса доставки. 
Contacts - реализует интерфейс IOrderForm. Выводит на страницу отображение второго окна оформления заказа с указанием контактного email и телефона.

**5. Класс Modal**
Является основой для всех модальных окон на странице. 
Наследует Component, реализует интерфейс IModalData. Принимает HTML-элемент и добавляет его в модальное окно на странице.
В полях содержит closeButton (кнопку закрытия окна) и content (кодержимое модального окна, получаемое в виде HTML-элемента).
Также содержит методы работы с можальными окнами:
* open - открытие модального окна;
* close - закрытие модального окна;
* render - сборка окна.

**6. Класс Success**
Наследует Component, реализует интерфейс ISuccess.
Отвечает за отрисовку окна подтверждения оформленного заказа. Принимает total - финальную сумму заказа для вывода ее через поле total класса.

## Ключевые типы данных

//данные страницы для отрисовки  
interface IPage {  
    counter: number; //счетчик товаров в корзине  
    catalog: HTMLElement[]; //каталог товаров, массив HTML-элементов  
    locked: boolean; //заблокирована ли прокрутка на странице, true или false  
}

//данные карточки для отрисовки  
interface ICard<T> {  
    id: string; //id продукта;  
    category?: string; //категория продукта  
    description?: string | string[]; //описание товара  
    image?: string; //изображение товара  
    price: number | string; //цена товара  
    title: string; //название товара  
    index?: number; //индекс товара (для отображения карточки в корзине)  
    button: string[]; //кнопка товара - принимает массив данных id, среди которых находит или не находит товар в корзине  
}    

//данные корзины для отрисовки  
interface IBasketView {  
    items: HTMLElement[]; //массив HTML-элементов карточек с продуктами  
    total: number; //сумма заказа  
}

//данные каждого продукта
 interface IProduct {  
  category?: string; //категория продукта  
  description?: string; //описание товара  
  id: string; //id товара  
  image: string; //изображение товара  
  price: number | null; //цена товара  
  title: string; //название товара  
}  

//данные приложения  
interface IAppState {  
  catalog: IProduct[]; //каталог  
  basket: string[]; //корзина  
  preview: string | null; //превью  
  order: IOrder | null; //заказ  
}

//данные формы  
interface IOrderForm {  
  payment: string; //метод оплаты  
  address: string; //адрес доставки  
  email: string; //контактный email  
  phone: string; //контактный телефон  
}

//данные заказа  
interface IOrder extends IOrderForm {  
  items: string[]; //товары в оформленном заказе  
  total: number; //финальная сумма заказа  
}

//ошибки для валидации форм  
type FormErrors = Partial<Record<keyof IOrder, string>>;   

//данные оформленного заказа  
interface IOrderResult {  
  id: string; //id заказа, отправленного на сервер  
}

//все события в приложении  

- 'items:show'; //вывод каталога с продуктами на страницу
- 'card:select'; //выбор карточки с продуктом
- 'preview:open'; //открытие модального окна с выбранной карточкой
- 'basket:open'; //открытие корзины
- 'card:add'; //добавление продукта в корзину
- 'card:delete'; //удаление продукта из корзины
- 'basket:changed'; //в корзину внесены изменения
- 'order:open'; //открыта форма оформления заказа
- 'payment:chosen'; //выбран метод оплаты заказа
- 'order:submit'; //подтверждены поля "метод оплаты" и "адрес"
- 'contacts:submit'; //подтверждена и отправлена на сервер форма оформления заказа
- 'orderFormErrors:change'; //изменилось состояние валидации формы 'order'
- 'contactsFormErrors:change'; //изменилось состояние валидации формы contacts
- /^order\..*:change/ ; //изменилось одно из полей формы 'order'
- /^contacts\..*:change/ ; //изменилось одно из полей формы 'contacts'
- 'modal:open'; //блокируем прокрутку страницы, если открыто модальное окно
- 'modal:close'; //разблокируем прокрутку страницы, если модальное окно не открыто



